<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ApoioJÃ¡ - InÃ­cio</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <main class="home-container">
    <div class="home-content">
      <h1 class="home-title">ğŸ’™ ApoioJÃ¡</h1>
      <p class="home-subtitle">Um espaÃ§o seguro e anÃ´nimo para pedir ajuda e denunciar.</p>

      <div class="home-actions">
        <a href="/denuncia" class="btn btn-primary">ğŸš¨ Fazer uma DenÃºncia</a>
        <button onclick="panicButton()" class="btn btn-silent">ğŸ•µï¸ Modo SilÃªncio</button>
      </div>

      <img src="{{ url_for('static', filename='apoioja_banner.png') }}" alt="Banner ApoioJÃ¡" class="home-banner">
    </div>
  </main>

  <!-- Chatbot widget (botÃ£o) -->
  <div id="chatbot" class="chatbot" style="display:none;">
    <div class="chat-header">ğŸ¤– ApoioJÃ¡ Chat</div>
    <div id="chat-box" class="chat-box"></div>
    <div class="chat-input">
      <input id="chatMessage" type="text" placeholder="Escreva aqui..." />
      <button id="sendChat">Enviar</button>
    </div>
  </div>
  <button id="openChat" class="chat-toggle">ğŸ’¬</button>

  <script>
    function panicButton() {
      try { localStorage.clear(); sessionStorage.clear(); } catch(e){}
      window.location.href = 'https://www.google.com';
    }

    // Chat widget JS (reaproveitado tambÃ©m em denuncia.html)
    (function(){
      const chatDiv = document.getElementById("chatbot");
      const toggle = document.getElementById("openChat");
      const sendBtn = document.getElementById("sendChat");
      const chatBox = document.getElementById("chat-box");
      const input = document.getElementById("chatMessage");

      toggle.addEventListener("click", () => {
        const visible = chatDiv.style.display === "block";
        chatDiv.style.display = visible ? "none" : "block";
      });

      async function sendMessage(){
        const text = input.value.trim();
        if(!text) return;
        chatBox.innerHTML += `<div class="user-msg">${escapeHtml(text)}</div>`;
        input.value = "";
        try {
          const resp = await fetch("/api/chat", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({message: text})
          });
          const data = await resp.json();
          chatBox.innerHTML += `<div class="bot-msg">${escapeHtml(data.reply || data.error || "Sem resposta")}</div>`;
        } catch {
          chatBox.innerHTML += `<div class="bot-msg">Erro de conexÃ£o.</div>`;
        }
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      sendBtn.addEventListener("click", sendMessage);
      input.addEventListener("keydown", (e) => { if(e.key === "Enter") sendMessage(); });

      function escapeHtml(unsafe){
        return unsafe.replace(/[&<"'>]/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#039;"})[m]; });
      }
    })();
  </script>
</body>
</html>
