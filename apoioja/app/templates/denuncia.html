<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Registrar Den√∫ncia - ApoioJ√°</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header class="topbar">
    <h1 class="brand">üíô ApoioJ√°</h1>
    <button onclick="panicButton()" class="btn-silent" title="Modo Sil√™ncio">üïµÔ∏è</button>
  </header>

  <main class="page-center">
    <div class="form-container">
      <!-- Banner acima do formul√°rio -->
      <img src="{{ url_for('static', filename='apoioja_banner.png') }}" alt="Banner ApoioJ√°" class="banner-img">

      <h2>Registrar Den√∫ncia</h2>
      <p class="subtitle">Seu relato √© totalmente an√¥nimo e protegido.</p>

      <form id="formDenuncia" class="denuncia-form" autocomplete="off" novalidate>
        <div class="form-group">
          <label for="categoria">Categoria</label>
          <input type="text" id="categoria" placeholder="Ex: viol√™ncia dom√©stica" required>
        </div>

        <div class="form-group">
          <label for="local">Local</label>
          <input type="text" id="local" placeholder="Ex: resid√™ncia, trabalho, rua..." required>
        </div>

        <div class="form-group">
          <label for="descricao">Descri√ß√£o</label>
          <textarea id="descricao" placeholder="Descreva o ocorrido..." required></textarea>
        </div>

        <div class="actions">
          <button type="submit" class="btn btn-primary">üì® Enviar Den√∫ncia</button>
          <button type="button" class="btn btn-secondary" onclick="clearFields()">üßπ Limpar Campos</button>
          <button type="button" class="btn btn-secondary" onclick="toggleForm()">üôà Esconder</button>
        </div>
      </form>

      <p id="mensagem" class="mensagem" role="status"></p>

      <!-- Mapa mock abaixo -->
      <div class="map-container">
        <h3>üó∫Ô∏è Mapa Seguro </h3>
        <img src="{{ url_for('static', filename='mapa_mock.png') }}" alt="Mapa Simulado" class="map-img">
        <p class="map-caption">Mapa apenas ilustrativo enquanto a integra√ß√£o n√£o est√° pronta.</p>
      </div>
    </div>
  </main>

  <script>
  function clearFields() {
    const form = document.getElementById('formDenuncia');
    form.reset();
    try { localStorage.clear(); sessionStorage.clear(); } catch (e) {}
  }

  function toggleForm() {
    const form = document.getElementById('formDenuncia');
    form.style.display = (form.style.display === 'none') ? 'block' : 'none';
  }

  function panicButton() {
    try { localStorage.clear(); sessionStorage.clear(); } catch (e) {}
    window.location.href = 'https://www.google.com';
  }

  document.getElementById('formDenuncia').addEventListener('submit', async (e) => {
    e.preventDefault();

    const data = {
      category: document.getElementById('categoria').value.trim(),
      description: document.getElementById('descricao').value.trim(),
      location: document.getElementById('local').value.trim()
    };

    if (!data.category || !data.description || !data.location) {
      document.getElementById('mensagem').innerText = 'Por favor, preencha todos os campos.';
      document.getElementById('mensagem').style.color = '#E74C3C';
      return;
    }

    try {
      const resp = await fetch('/api/reports', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });

      if (resp.ok) {
        const json = await resp.json();
        document.getElementById('mensagem').innerText = json.message || '‚úÖ Den√∫ncia enviada com sucesso.';
        document.getElementById('mensagem').style.color = '#2E8B57';
        clearFields(); // limpa automaticamente ap√≥s o envio
      } else {
        document.getElementById('mensagem').innerText = '‚ùå Erro ao enviar den√∫ncia. Tente novamente.';
        document.getElementById('mensagem').style.color = '#E74C3C';
      }
    } catch (err) {
      document.getElementById('mensagem').innerText = '‚ö†Ô∏è Falha de conex√£o com o servidor.';
      document.getElementById('mensagem').style.color = '#E67E22';
    }
  });
</script>